<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Research Tracker</title>
  <link rel="stylesheet" href="../../css/popup.css">
</head>
<body>
  <div class="container">
    <div class="header-container">
      <h1>Research Tracker</h1>
      <button id="settings-btn" class="settings-btn" title="Settings">
        <span class="settings-icon">⚙️</span>
      </button>
    </div>
    
    <!-- Popout functionality removed
    <div class="window-controls">
      <button id="popout-btn" class="window-control-btn" title="Pop out window">
        <span class="control-icon">⇱</span>
      </button>
    </div>
    -->
    
    <div id="controls" class="section">
      <div id="status">
        <p>Recording Status: <span id="recording-status">Not Recording</span></p>
      </div>
      
      <div id="session-name-input" class="start-only">
        <label for="session-name">Session Name:</label>
        <input type="text" id="session-name" placeholder="My Research Session">
      </div>
      
      <div id="buttons">
        <button id="start-btn" class="action-btn">Record</button>
        <button id="pause-btn" class="action-btn" disabled>Pause</button>
        <button id="stop-btn" class="action-btn" disabled>Stop</button>
      </div>
    </div>
    
    <div id="current-session" class="section hidden">
      <h2>Current Session: <span id="current-session-name">Unnamed</span></h2>
      <p>Started: <span id="session-start-time">-</span></p>
      <p>Events recorded: <span id="event-count">0</span></p>
      
      <div id="session-status">
        <h3>Session Activity</h3>
        
        <div class="status-section">
          <h4>Current Page</h4>
          <div id="current-page" class="page-item selectable"></div>
        </div>
        
        <div class="action-buttons">
          <button id="view-pages-btn" class="action-btn">View Recent Pages</button>
          <button id="view-searches-btn" class="action-btn">View Recent Searches</button>
        </div>
      </div>
      
      <!-- Metadata Edit Modal -->
      <div id="metadata-modal" class="modal hidden" style="display: none;">
        <div class="modal-content wide-modal">
          <span class="close-modal">&times;</span>
          <h3>Edit Page Metadata</h3>
          
          <div class="metadata-form-grid">
            <div class="form-group full-width">
              <label for="metadata-title">Title:</label>
              <input type="text" id="metadata-title" placeholder="Page Title">
            </div>
            
            <div class="form-group">
              <label for="metadata-author">Author(s):</label>
              <input type="text" id="metadata-author" placeholder="Author names (comma-separated if multiple)">
            </div>
            
            <div class="form-group">
              <label for="metadata-date">Publication Date:</label>
              <input type="text" id="metadata-date" placeholder="YYYY-MM-DD or as shown">
            </div>
            
            <div class="form-group">
              <label for="metadata-publisher">Publisher/Source:</label>
              <input type="text" id="metadata-publisher" placeholder="Publisher or website name">
            </div>
            
            <div class="form-group">
              <label for="metadata-journal">Journal:</label>
              <input type="text" id="metadata-journal" placeholder="Journal name (if applicable)">
            </div>
            
            <div class="form-group">
              <label for="metadata-doi">DOI:</label>
              <input type="text" id="metadata-doi" placeholder="10.xxxx/xxxxx">
            </div>
            
            <div class="form-group">
              <label for="metadata-type">Content Type:</label>
              <select id="metadata-type">
                <option value="">-- Select Type --</option>
                <option value="journal-article">Journal Article</option>
                <option value="preprint">Preprint</option>
                <option value="news-article">News Article</option>
                <option value="report">Report</option>
                <option value="book">Book</option>
                <option value="encyclopedia-article">Encyclopedia Article</option>
                <option value="social-media-post">Social Media Post</option>
                <option value="website">Website</option>
                <option value="other">Other</option>
              </select>
            </div>
            
            <div class="form-group full-width" id="metadata-info">
              <!-- Dynamic info about extraction method will be inserted here -->
            </div>
          </div>
          
          <div class="modal-buttons">
            <button id="save-metadata-btn" class="action-btn">Save Metadata</button>
            <button id="cancel-metadata-btn" class="action-btn secondary-btn">Cancel</button>
          </div>
        </div>
      </div>
      
      <!-- Add Note Modal -->
      <div id="note-modal" class="modal hidden" style="display: none;">
        <div class="modal-content">
          <span class="close-note-modal">&times;</span>
          <h3>Add Note for <span id="note-target">Current Page</span></h3>
          
          <div class="form-group">
            <textarea id="note-input" placeholder="Add your observations about this page..."></textarea>
          </div>
          
          <div class="modal-buttons">
            <button id="save-note-btn" class="action-btn">Save Note</button>
            <button id="cancel-note-btn" class="action-btn secondary-btn">Cancel</button>
          </div>
        </div>
      </div>
      
      <!-- Recent Pages Modal -->
      <div id="pages-modal" class="modal hidden" style="display: none;">
        <div class="modal-content wide-modal">
          <span class="close-pages-modal">&times;</span>
          <h3>Recent Content Pages</h3>
          
          <div id="recent-pages" class="history-list modal-list"></div>
          
          <div class="modal-buttons">
            <button id="close-pages-btn" class="action-btn secondary-btn">Close</button>
          </div>
        </div>
      </div>
      
      <!-- Recent Searches Modal -->
      <div id="searches-modal" class="modal hidden" style="display: none;">
        <div class="modal-content wide-modal">
          <span class="close-searches-modal">&times;</span>
          <h3>Recent Searches</h3>
          
          <div id="recent-searches" class="history-list modal-list"></div>
          
          <div class="modal-buttons">
            <button id="close-searches-btn" class="action-btn secondary-btn">Close</button>
          </div>
        </div>
      </div>
      
      <!-- Settings Modal -->
      <div id="settings-modal" class="modal hidden" style="display: none;">
        <div class="modal-content">
          <span class="close-settings-modal">&times;</span>
          <h3>Settings</h3>
          
          <div class="settings-section">
            <h4>Citation Format</h4>
            
            <div class="form-group">
              <label for="citation-format">Select Citation Style:</label>
              <select id="citation-format">
                <option value="apa">APA 7th Edition</option>
                <option value="mla">MLA 9th Edition</option>
                <option value="chicago">Chicago 17th Edition</option>
                <option value="harvard">Harvard</option>
                <option value="ieee">IEEE</option>
                <option value="custom">Custom Format</option>
              </select>
            </div>
            
            <div class="form-group">
              <label>
                <input type="checkbox" id="citation-preview-enabled"> 
                Show citation preview on pages
              </label>
              <div class="setting-description">
                Displays a floating citation preview in the bottom-right corner of web pages
              </div>
            </div>
            
            <div id="custom-format-section" class="form-group" style="display: none;">
              <label for="custom-format-template">Custom Citation Template:</label>
              <textarea id="custom-format-template" rows="4" placeholder="{author} ({year}). {title}. {publisher}."></textarea>
              <div class="template-help">
                <p><strong>Available variables:</strong></p>
                <ul>
                  <li><code>{author}</code> - All author names</li>
                  <li><code>{authorShort}</code> - First author et al. (3+ authors)</li>
                  <li><code>{year}</code> - Publication year (YYYY)</li>
                  <li><code>{yearShort}</code> - Publication year (YY)</li>
                  <li><code>{month}</code> - Publication month (full name)</li>
                  <li><code>{monthNum}</code> - Publication month (MM)</li>
                  <li><code>{day}</code> - Publication day (DD)</li>
                  <li><code>{date}</code> - Publication date (MM/DD/YYYY)</li>
                  <li><code>{title}</code> - Page/article title</li>
                  <li><code>{publisher}</code> - Publisher or website name</li>
                  <li><code>{journal}</code> - Journal name</li>
                  <li><code>{doi}</code> - Digital Object Identifier</li>
                  <li><code>{url}</code> - Page URL</li>
                  <li><code>{accessDate}</code> - Today's date</li>
                  <li><code>{accessDateShort}</code> - Today's date (MM/DD/YYYY)</li>
                </ul>
                <p><strong>Example:</strong> {author} ({yearShort}). {title}. {publisher}. Retrieved {accessDateShort} from {url}</p>
              </div>
            </div>
          </div>
          
          <div class="modal-buttons">
            <button id="save-settings-btn" class="action-btn">Save Settings</button>
            <button id="cancel-settings-btn" class="action-btn secondary-btn">Cancel</button>
          </div>
        </div>
      </div>
    </div>
    
    <div id="sessions-section" class="section">
      <h2>Previous Sessions</h2>
      <div id="sessions-list">
        <p id="no-sessions-msg">No completed sessions yet</p>
      </div>
    </div>
  </div>
  
  <script src="popup.js"></script>
</body>
</html>